final jPackageName = 'jPackage'

tasks.register('ensurejPackageDir') {
    doLast {
        mkdir layout.buildDirectory.dir(jPackageName)
    }
}

tasks.register(jPackageName) {
    dependsOn 'ensurejPackageDir'
    dependsOn 'installDist'
}

tasks.installDist.configure {
    doLast {
        def libDir = getDistsDirectory().dir('lib')

        tasks.named(jPackageName).configure {
            input = libDir
        }
    }
}

tasks.named(jPackageName).configure {
    destination = "$buildDir/$jPackageName"

    appName = project.appName
    appVersion = project.version.toString()
    vendor = project.vendor

    mainJar = tasks.jar.archiveFileName.get()
    mainClass = project.mainClassName

    linux {
        linuxShortcut = true
    }

    windows {
        winMenu = true
        winDirChooser = true
        winShortcut = true
    }
}